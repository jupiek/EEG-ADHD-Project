---
title: "EDA"
author: "Julie Kim"
date: "2/13/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = FALSE, message = FALSE}
library(tidyverse)
library(ggplot2)
library(glmnet)
library(pander)
```
    
####Read in, Clean up

+ Group left/right (3x variable reduction)
+ Subtract baseline from activity (2x variable reduction)
+ Include both alpha/theta
    
    Read Data
    ```{r}
    #Read Data
    df = read.csv("ADHD_EEG_Dataset.csv")
    dim(df)
    
    #Subset of data to contain only the ID, response, and EEG readings
    #i.e. exclude demographic data
    df = df[,c(1,2,40:163)]
    
    #Omit all NA's
    df = na.omit(df)
    dim(df)
    ```
    
    Group Data
    ```{r}
    #Group the brain regions based on their position (left/right)
    #Method: Average reading
    #Odd numbers are left, even numbers right
    data = df[,1:2]
    
    #Baseline Activity - Alpha Band
    data$BS_LF_ALPHA = NA
    data$BS_RF_ALPHA = NA
    data$BS_LC_ALPHA = df$BS_C3_ALPHA
    data$BS_RC_ALPHA = df$BS_C4_ALPHA
    data$BS_LT_ALPHA = df$BS_T7_ALPHA
    data$BS_RT_ALPHA = df$BS_T8_ALPHA
    data$BS_LP_ALPHA = NA
    data$BS_RP_ALPHA = NA
    data$BS_LO_ALPHA = df$BS_O1_ALPHA
    data$BS_RO_ALPHA = df$BS_O2_ALPHA
    
    #Baseline Activity - Theta Band
    data$BS_LF_THETA = NA
    data$BS_RF_THETA = NA
    data$BS_LC_THETA = df$BS_C3_THETA
    data$BS_RC_THETA = df$BS_C4_THETA
    data$BS_LT_THETA = df$BS_T7_THETA
    data$BS_RT_THETA = df$BS_T8_THETA
    data$BS_LP_THETA = NA
    data$BS_RP_THETA = NA
    data$BS_LO_THETA = df$BS_O1_THETA
    data$BS_RO_THETA = df$BS_O2_THETA
    
    #Attention Task Activity - Alpha Band
    data$AT_LF_ALPHA = NA
    data$AT_RF_ALPHA = NA
    data$AT_LC_ALPHA = df$AT_C3_ALPHA
    data$AT_RC_ALPHA = df$AT_C4_ALPHA
    data$AT_LT_ALPHA = df$AT_T7_ALPHA
    data$AT_RT_ALPHA = df$AT_T8_ALPHA
    data$AT_LP_ALPHA = NA
    data$AT_RP_ALPHA = NA
    data$AT_LO_ALPHA = df$AT_O1_ALPHA
    data$AT_RO_ALPHA = df$AT_O2_ALPHA
    
    #Attention Task Activity - Theta Band
    data$AT_LF_THETA = NA
    data$AT_RF_THETA = NA
    data$AT_LC_THETA = df$AT_C3_THETA
    data$AT_RC_THETA = df$AT_C4_THETA
    data$AT_LT_THETA = df$AT_T7_THETA
    data$AT_RT_THETA = df$AT_T8_THETA
    data$AT_LP_THETA = NA
    data$AT_RP_THETA = NA
    data$AT_LO_THETA = df$AT_O1_THETA
    data$AT_RO_THETA = df$AT_O2_THETA
    
    for (i in 1:nrow(df)) {
      #Baseline Activity - Alpha Band
      data$BS_LF_ALPHA[i] = mean(df$BS_F1_ALPHA[i], df$BS_F3_ALPHA[i], df$BS_F7_ALPHA[i])
      data$BS_RF_ALPHA[i] = mean(df$BS_F2_ALPHA[i], df$BS_F4_ALPHA[i], df$BS_F8_ALPHA[i])
      data$BS_LP_ALPHA[i] = mean(df$BS_P7_ALPHA[i], df$BS_P3_ALPHA[i])
      data$BS_RP_ALPHA[i] = mean(df$BS_P8_ALPHA[i], df$BS_P4_ALPHA[i])
      #Baseline Activity - Theta Band
      data$BS_LF_THETA[i] = mean(df$BS_F1_THETA[i], df$BS_F3_THETA[i], df$BS_F7_THETA[i])
      data$BS_RF_THETA[i] = mean(df$BS_F2_THETA[i], df$BS_F4_THETA[i], df$BS_F8_THETA[i])
      data$BS_LP_THETA[i] = mean(df$BS_P7_THETA[i], df$BS_P3_THETA[i])
      data$BS_RP_THETA[i] = mean(df$BS_P8_THETA[i], df$BS_P4_THETA[i])
      
      #Attention Task Activity - Alpha Band
      data$AT_LF_ALPHA[i] = mean(df$AT_F1_ALPHA[i], df$AT_F3_ALPHA[i], df$AT_F7_ALPHA[i])
      data$AT_RF_ALPHA[i] = mean(df$AT_F2_ALPHA[i], df$AT_F4_ALPHA[i], df$AT_F8_ALPHA[i])
      data$AT_LP_ALPHA[i] = mean(df$AT_P7_ALPHA[i], df$AT_P3_ALPHA[i])
      data$AT_RP_ALPHA[i] = mean(df$AT_P8_ALPHA[i], df$AT_P4_ALPHA[i])
      #Attention Task Activity - Theta Band
      data$AT_LF_THETA[i] = mean(df$AT_F1_THETA[i], df$AT_F3_THETA[i], df$AT_F7_THETA[i])
      data$AT_RF_THETA[i] = mean(df$AT_F2_THETA[i], df$AT_F4_THETA[i], df$AT_F8_THETA[i])
      data$AT_LP_THETA[i] = mean(df$AT_P7_THETA[i], df$AT_P3_THETA[i])
      data$AT_RP_THETA[i] = mean(df$AT_P8_THETA[i], df$AT_P4_THETA[i])
    }
    
    #Baseline Connectivity - Alpha Band
    data$BS_LFF_ALPHA = NA
    data$BS_RFF_ALPHA = NA
    data$BS_LFC_ALPHA = df$BS_F3C3_ALPHA
    data$BS_RFC_ALPHA = df$BS_F4C4_ALPHA
    data$BS_LFP_ALPHA = NA
    data$BS_RFP_ALPHA = NA
    data$BS_LFT_ALPHA = df$BS_F3T7_ALPHA            
    data$BS_RFT_ALPHA = df$BS_F4T8_ALPHA
    data$BS_LFO_ALPHA = df$BS_F3O1_ALPHA
    data$BS_RFO_ALPHA = df$BS_F4O2_ALPHA
    
    #Baseline Connectivity - Theta Band
    data$BS_LFF_THETA = NA
    data$BS_RFF_THETA = NA
    data$BS_LFC_THETA = df$BS_F3C3_THETA
    data$BS_RFC_THETA = df$BS_F4C4_THETA
    data$BS_LFP_THETA = NA
    data$BS_RFP_THETA = NA
    data$BS_LFT_THETA = df$BS_F3T7_THETA            
    data$BS_RFT_THETA = df$BS_F4T8_THETA
    data$BS_LFO_THETA = df$BS_F3O1_THETA
    data$BS_RFO_THETA = df$BS_F4O2_THETA
    
    #Attention Task Connectivity - Alpha Band
    data$AT_LFF_ALPHA = NA
    data$AT_RFF_ALPHA = NA
    data$AT_LFC_ALPHA = df$AT_F3C3_ALPHA
    data$AT_RFC_ALPHA = df$AT_F4C4_ALPHA
    data$AT_LFP_ALPHA = NA
    data$AT_RFP_ALPHA = NA
    data$AT_LFT_ALPHA = df$AT_F3T7_ALPHA            
    data$AT_RFT_ALPHA = df$AT_F4T8_ALPHA
    data$AT_LFO_ALPHA = df$AT_F3O1_ALPHA
    data$AT_RFO_ALPHA = df$AT_F4O2_ALPHA
    
    #Attention Task Connectivity - Theta Band
    data$AT_LFF_THETA = NA
    data$AT_RFF_THETA = NA
    data$AT_LFC_THETA = df$AT_F3C3_THETA
    data$AT_RFC_THETA = df$AT_F4C4_THETA
    data$AT_LFP_THETA = NA
    data$AT_RFP_THETA = NA
    data$AT_LFT_THETA = df$AT_F3T7_THETA            
    data$AT_RFT_THETA = df$AT_F4T8_THETA
    data$AT_LFO_THETA = df$AT_F3O1_THETA
    data$AT_RFO_THETA = df$AT_F4O2_THETA
    
    for (i in 1:nrow(df)) {
      #Baseline Connectivity - Alpha Band
      data$BS_LFF_ALPHA[i] = mean(df$BS_F1F3_ALPHA[i], df$BS_F3F7_ALPHA[i])
      data$BS_RFF_ALPHA[i] = mean(df$BS_F2F4_ALPHA[i], df$BS_F4F8_ALPHA[i])
      data$BS_LFP_ALPHA[i] = mean(df$BS_F3P3_ALPHA[i], df$BS_F3P7_ALPHA[i])
      data$BS_RFP_ALPHA[i] = mean(df$BS_F4P8_ALPHA[i], df$BS_F4P4_ALPHA[i])
      #Baseline Connectivity - Theta Band
      data$BS_LFF_THETA[i] = mean(df$BS_F1F3_THETA[i], df$BS_F3F7_THETA[i])
      data$BS_RFF_THETA[i] = mean(df$BS_F2F4_THETA[i], df$BS_F4F8_THETA[i])
      data$BS_LFP_THETA[i] = mean(df$BS_F3P3_THETA[i], df$BS_F3P7_THETA[i])
      data$BS_RFP_THETA[i] = mean(df$BS_F4P8_THETA[i], df$BS_F4P4_THETA[i])
      
      #Attention Task Connectivity - Alpha Band
      data$AT_LFF_ALPHA[i] = mean(df$AT_F1F3_ALPHA[i], df$AT_F3F7_ALPHA[i])
      data$AT_RFF_ALPHA[i] = mean(df$AT_F2F4_ALPHA[i], df$AT_F4F8_ALPHA[i])
      data$AT_LFP_ALPHA[i] = mean(df$AT_F3P3_ALPHA[i], df$AT_F3P7_ALPHA[i])
      data$AT_RFP_ALPHA[i] = mean(df$AT_F4P8_ALPHA[i], df$AT_F4P4_ALPHA[i])
      #Attention Task Connectivity - Theta Band
      data$AT_LFF_THETA[i] = mean(df$AT_F1F3_THETA[i], df$AT_F3F7_THETA[i])
      data$AT_RFF_THETA[i] = mean(df$AT_F2F4_THETA[i], df$AT_F4F8_THETA[i])
      data$AT_LFP_THETA[i] = mean(df$AT_F3P3_THETA[i], df$AT_F3P7_THETA[i])
      data$AT_RFP_THETA[i] = mean(df$AT_F4P8_THETA[i], df$AT_F4P4_THETA[i])
    }
    
    data$BS_time = df$BS_time
    data$BS_dft = df$BS_dft
    data$AT_time = df$AT_time
    data$AT_dft = df$AT_dft
    ```
    
    Subtract Baseline from Activity
    + The change of the activity/connectivity from baseline are all saved to a new data frame calld "data.change"
    ```{r}
    # Subtract baseline activity/ connectivity signal from activity
    data.change <- mutate(data,
                    # EEG Activity Subtraction
                    LF_ALPHA = AT_LF_ALPHA - BS_LF_ALPHA,
                    RF_ALPHA = AT_RF_ALPHA - BS_RF_ALPHA,
                    LC_ALPHA = AT_LC_ALPHA - BS_LC_ALPHA,
                    RC_ALPHA = AT_RC_ALPHA - BS_RC_ALPHA,
                    LT_ALPHA = AT_LT_ALPHA - BS_LT_ALPHA,
                    RT_ALPHA = AT_RT_ALPHA - BS_RT_ALPHA,
                    LP_ALPHA = AT_LP_ALPHA - BS_LP_ALPHA,
                    RP_ALPHA = AT_RP_ALPHA - BS_RP_ALPHA,
                    LO_ALPHA = AT_LO_ALPHA - BS_LO_ALPHA,
                    RO_ALPHA = AT_RO_ALPHA - BS_RO_ALPHA,
                    LF_THETA = AT_LF_THETA - BS_LF_THETA,
                    RF_THETA = AT_RF_THETA - BS_RF_THETA,
                    LC_THETA = AT_LC_THETA - BS_LC_THETA,
                    RC_THETA = AT_RC_THETA - BS_RC_THETA,
                    LT_THETA = AT_LT_THETA - BS_LT_THETA,
                    RT_THETA = AT_RT_THETA - BS_RT_THETA,
                    LP_THETA = AT_LP_THETA - BS_LP_THETA,
                    RP_THETA = AT_RP_THETA - BS_RP_THETA,
                    LO_THETA = AT_LO_THETA - BS_LO_THETA,
                    RO_THETA = AT_RO_THETA - BS_RO_THETA,
                    #Connectivity
                    LFF_ALPHA = AT_LFF_ALPHA - BS_LFF_ALPHA,
                    RFF_ALPHA = AT_RFF_ALPHA - BS_RFF_ALPHA,
                    LFC_ALPHA = AT_LFC_ALPHA - BS_LFC_ALPHA,
                    RFC_ALPHA = AT_RFC_ALPHA - BS_RFC_ALPHA,
                    LFP_ALPHA = AT_LFP_ALPHA - BS_LFP_ALPHA,
                    RFP_ALPHA = AT_RFP_ALPHA - BS_RFP_ALPHA,
                    LFT_ALPHA = AT_LFT_ALPHA - BS_LFT_ALPHA,
                    RFT_ALPHA = AT_RFT_ALPHA - BS_RFT_ALPHA,
                    LFO_ALPHA = AT_LFO_ALPHA - BS_LFO_ALPHA,
                    RFO_ALPHA = AT_RFO_ALPHA - BS_RFO_ALPHA,
                    LFF_THETA = AT_LFF_THETA - BS_LFF_THETA,
                    RFF_THETA = AT_RFF_THETA - BS_RFF_THETA,
                    LFC_THETA = AT_LFC_THETA - BS_LFC_THETA,
                    RFC_THETA = AT_RFC_THETA - BS_RFC_THETA,
                    LFP_THETA = AT_LFP_THETA - BS_LFP_THETA,
                    RFP_THETA = AT_RFP_THETA - BS_RFP_THETA,
                    LFT_THETA = AT_LFT_THETA - BS_LFT_THETA,
                    RFT_THETA = AT_RFT_THETA - BS_RFT_THETA,
                    LFO_THETA = AT_LFO_THETA - BS_LFO_THETA,
                    RFO_THETA = AT_RFO_THETA - BS_RFO_THETA,
                    time = AT_time - BS_time,
                    dft = AT_dft - BS_dft
    )

    data = data.change[,-c(3:86)]
    data
    dim(data)
    ```

    Scale Data
    ```{r}
    #Scale data to be centered at 0, with standard deviation 1
    data = as.data.frame(cbind(ID = data[,1], ADHD = data[,2], scale(data[,-c(1,2)])))

    #Check that dataset is normalized
    checkMat = round(colMeans(data[,-c(1,2)]),10)==0
    ifelse(length(checkMat[checkMat==TRUE])/length(checkMat)==1,
          print("Data to be centered at 0 success"),
          print("Data to be centered at 0 fail"))
    checkMat2 = round(apply(data[,-c(1,2)], 2, sd),10)==1
    ifelse(length(checkMat2[checkMat2==TRUE])/length(checkMat2)==1,
          print("Data to have standard deviation of 1 success"),
          print("Data to have standard deviation of 1 fail"))

    # Print Data Set of interst and its dimension
    data
    dim(data)
    ```
    
####Model fitting: Elastic Net (Lasso and Ridge Regression Combined)

    Model fitting
    ```{r}
    #Fit Elastic Net regression and choose significant classifiers/ predictors
    ###WANHE & JAE'S CODE HERE
    ```

    Cross Validation (number of folds should be specified)
    ```{r}
    #Cross Validation - specify the number of folds
    ###WANHE & JAE'S CODE HERE
    ```
    
####Diagnostics

    Cross Validation Error
    ```{r}
    ###WANHE & JAE'S CODE HERE
    ```
    
    Anything else that could be applied - recommended by Cassie and Kevin
    ```{r}
    ###WANHE & JAE'S CODE HERE
    ```
